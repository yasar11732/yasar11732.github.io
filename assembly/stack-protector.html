<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="description" content="GCC'nin -fstack-protector özelliği nasıl çalışır?">
<meta name="viewport" content="width=device-width">
<title>GCC'nin Stack Koruması | YSAR.NET</title>
<link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700,900%7CUbuntu:300,400,500,700" rel="stylesheet">
<link href="../assets/icons/foundation-icons.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/style.css" rel="stylesheet" type="text/css">
<script defer src="../assets/js/misc.js"></script><meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="tr" href="../rss.xml">
<link rel="canonical" href="https://yasar11732.github.io/assembly/stack-protector.html">
<!--[if lt IE 9]><script src="../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Yaşar Arabacı">
<link rel="prev" href="../diger/yeni-tasarim.html" title="Blog Tasarımım Yenilendi" type="text/html">
<link rel="next" href="../windows/windows-api-ile-ekran-goruntusu.html" title="Windows Api İle Ekran Görüntüsü Yakalamak" type="text/html">
</head>
<body>

         
    <header class="fixed-top"><div class="container">
        <a href="http://ysar.net">
            <img class="logo" src="../assets/img/Logo.svg"></a>
        <div class="subtitle">Python, Yazılım ve Programlama</div>
    <nav id="menu"><ul>
<li class="fi-info"><a href="../yasar-arabaci.html">Hakkımda</a></li>
            <li class="fi-social-github"><a href="https://github.com/yasar11732/">GitHub</a></li>
            <li class="question"><a href="../soru-cevap.html">Soru-Cevap</a></li>
            <li class="fi-rss"><a href="../rss.xml">RSS</a></li>
        </ul></nav>
</div>
        
    </header><main class="main-content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 itemprop="headline name">GCC'nin Stack Koruması</h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>C dilinde, fonksiyon argümanları, yerel değişkenler (statik olmayan) ve fonksiyon çağrısı bittiğinde
programın çalışmaya devam edeceği dönüş adresi stack'de tutuluyor. Program hafızasının LIFO mantığıyla
çalışan bu bölümü, fonksiyonların birbiriyle iletişimi ve program
akışının sağlanması açısından önemli. Stack'in kötü niyetli kullanım veya programlama hatası nedeniyle bozulması, programın hatalı
sonuç üretmesi, çökmesi veya yetkisiz işleme izin vermesi gibi çeşitli olumsuzluklara neden olabilir.
Modern C derleyicileri, bu tip olumsuzlukları kontrol altında tutmak için bir yöntem kullanıyor.</p>
<p>Öncelikle sorunu görmek açısından, aşağıdaki programı gcc'nin bu özelliğini
kapatarak (-fno-stack-protector seçeneği ile) derleyip, programın assembly koduna bakalım.</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><span class="kt">void</span> <span class="nf">return_input</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><span class="p">{</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code>    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code>    <span class="n">gets</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code>    <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code><span class="p">}</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code><span class="p">{</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code>    <span class="n">return_input</span><span class="p">();</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-14"><code data-line-number="14"></code></a></td>
<td class="code"><code><span class="p">}</span>
</code></td>
</tr>
</table></div>

<p>Yukarıdaki fonksiyonda, <code>gets</code> fonksiyonu komut satırından bir metin alıp, <code>buffer</code> içine kaydedecek. Eğer,
okunan metin 11 haneden daha fazla ise, buffer için ayrılan hafızanın dışına yazmaya devam edecek. fno-stack-protector ile
derlenmiş programdaki, <code>return_input</code> fonksiyonu nasıl derlenmiş bir göz atalım.</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="k">Dump</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">assembler</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="nl">return_input</span><span class="p">:</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048404</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="err">:</span><span class="w">     </span><span class="n">push</span><span class="w">   </span><span class="n">ebp</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048405</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;</span><span class="err">:</span><span class="w">     </span><span class="n">mov</span><span class="w">    </span><span class="n">ebp</span><span class="p">,</span><span class="n">esp</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048407</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;</span><span class="err">:</span><span class="w">     </span><span class="n">sub</span><span class="w">    </span><span class="n">esp</span><span class="p">,</span><span class="mh">0x28</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x0804840a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">6</span><span class="o">&gt;</span><span class="err">:</span><span class="w">     </span><span class="n">lea</span><span class="w">    </span><span class="n">eax</span><span class="p">,</span><span class="o">[</span><span class="n">ebp-0x14</span><span class="o">]</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x0804840d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">9</span><span class="o">&gt;</span><span class="err">:</span><span class="w">     </span><span class="n">mov</span><span class="w">    </span><span class="n">DWORD</span><span class="w"> </span><span class="n">PTR</span><span class="w"> </span><span class="o">[</span><span class="n">esp</span><span class="o">]</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048410</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">12</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="k">call</span><span class="w">   </span><span class="mh">0x8048310</span><span class="w"> </span><span class="o">&lt;</span><span class="n">gets</span><span class="nv">@plt</span><span class="o">&gt;</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048415</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">17</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">lea</span><span class="w">    </span><span class="n">eax</span><span class="p">,</span><span class="o">[</span><span class="n">ebp-0x14</span><span class="o">]</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048418</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="n">DWORD</span><span class="w"> </span><span class="n">PTR</span><span class="w"> </span><span class="o">[</span><span class="n">esp</span><span class="o">]</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x0804841b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="k">call</span><span class="w">   </span><span class="mh">0x8048320</span><span class="w"> </span><span class="o">&lt;</span><span class="n">puts</span><span class="nv">@plt</span><span class="o">&gt;</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048420</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">28</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">leave</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048421</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">ret</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><span class="k">End</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">assembler</span><span class="w"> </span><span class="k">dump</span><span class="p">.</span><span class="w"></span>
</code></td>
</tr>
</table></div>

<p>Burada herşey normal. İlk iki satır C'deki standart fonksiyon çağırma geleneğine göre <code>ebp</code> register'ını ayarlıyor
. Daha sonra stack üzerinde 0x28 (40) byte yer ayrılıyor. Devamı ise,
<code>gets</code> ve <code>puts</code> fonksiyon çağrıları ve geri dönüş. Programı gdb ile çalıştırıp, buffer ve frame pointer
adreslerine bakabiliriz. Bende, <code>buffer</code>, <code>0xffffd704</code> adresinde, <code>ebp</code> ise, <code>0xffffd718</code> adresinde çıktı. Bu durumda,
<code>buffer</code> üzerine 0x14 (20) byte yazılması haline, <code>return_input</code> fonksiyonu için ayrılmış alanın dışına çıkılacak. Eğer
fonksiyonda başka yerel değişkenler olsaydı, bu değişkenlerin üzerine yazılması ihtimali de ortaya çıkacaktı. Peki,
fonksiyon için ayrılmış alanın dışında ne var? Öncelikle, bu fonksiyonu çağıran fonksiyonun (bu örnekte main) frame pointer'ı ve 
<code>return_input</code>'un dönüş adresi (main fonksiyonunda, <code>return_input</code> çağrısından sonraki adres), daha sonra, çağıran fonksiyonun yerel değişkenleri veya fonksiyon
çağrısından önce kaydettiği register değerleri olabilir. Bunların üzerine yazılması halinde, en iyi ihtimalle programın geçersiz
bir adrese zıplamaya çalışıp çökmesini umabiliriz. Kötü ihtimal ise, programa verilen kötü niyetle tasarlanmış bir metin yüzünden,
programın yetkisiz/zararlı işlemler yapması.</p>
<p>Aynı fonksiyonun <em>stack protector</em> aktif olarak derlenmiş hali aşağıdaki gibi;</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="k">Dump</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">assembler</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="nl">return_input</span><span class="p">:</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048464</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="err">:</span><span class="w">     </span><span class="n">push</span><span class="w">   </span><span class="n">ebp</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048465</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;</span><span class="err">:</span><span class="w">     </span><span class="n">mov</span><span class="w">    </span><span class="n">ebp</span><span class="p">,</span><span class="n">esp</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048467</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;</span><span class="err">:</span><span class="w">     </span><span class="n">sub</span><span class="w">    </span><span class="n">esp</span><span class="p">,</span><span class="mh">0x28</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x0804846a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">6</span><span class="o">&gt;</span><span class="err">:</span><span class="w">     </span><span class="n">mov</span><span class="w">    </span><span class="n">eax</span><span class="p">,</span><span class="nl">gs</span><span class="p">:</span><span class="mh">0x14</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048470</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">12</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="n">DWORD</span><span class="w"> </span><span class="n">PTR</span><span class="w"> </span><span class="o">[</span><span class="n">ebp-0xc</span><span class="o">]</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048473</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">15</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">xor</span><span class="w">    </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048475</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">17</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">lea</span><span class="w">    </span><span class="n">eax</span><span class="p">,</span><span class="o">[</span><span class="n">ebp-0x18</span><span class="o">]</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048478</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="n">DWORD</span><span class="w"> </span><span class="n">PTR</span><span class="w"> </span><span class="o">[</span><span class="n">esp</span><span class="o">]</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x0804847b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="k">call</span><span class="w">   </span><span class="mh">0x8048360</span><span class="w"> </span><span class="o">&lt;</span><span class="n">gets</span><span class="nv">@plt</span><span class="o">&gt;</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048480</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">28</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">lea</span><span class="w">    </span><span class="n">eax</span><span class="p">,</span><span class="o">[</span><span class="n">ebp-0x18</span><span class="o">]</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048483</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">31</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="n">DWORD</span><span class="w"> </span><span class="n">PTR</span><span class="w"> </span><span class="o">[</span><span class="n">esp</span><span class="o">]</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048486</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">34</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="k">call</span><span class="w">   </span><span class="mh">0x8048380</span><span class="w"> </span><span class="o">&lt;</span><span class="n">puts</span><span class="nv">@plt</span><span class="o">&gt;</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-14"><code data-line-number="14"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x0804848b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">39</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span><span class="w"> </span><span class="n">PTR</span><span class="w"> </span><span class="o">[</span><span class="n">ebp-0xc</span><span class="o">]</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-15"><code data-line-number="15"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x0804848e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">42</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">xor</span><span class="w">    </span><span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span><span class="w"> </span><span class="n">PTR</span><span class="w"> </span><span class="nl">gs</span><span class="p">:</span><span class="mh">0x14</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-16"><code data-line-number="16"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048495</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">49</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">je</span><span class="w">     </span><span class="mh">0x804849c</span><span class="w"> </span><span class="o">&lt;</span><span class="n">return_input</span><span class="o">+</span><span class="mi">56</span><span class="o">&gt;</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-17"><code data-line-number="17"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x08048497</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">51</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="k">call</span><span class="w">   </span><span class="mh">0x8048370</span><span class="w"> </span><span class="o">&lt;</span><span class="n">__stack_chk_fail</span><span class="nv">@plt</span><span class="o">&gt;</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-18"><code data-line-number="18"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x0804849c</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">56</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">leave</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-19"><code data-line-number="19"></code></a></td>
<td class="code"><code><span class="w">   </span><span class="mh">0x0804849d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">57</span><span class="o">&gt;</span><span class="err">:</span><span class="w">    </span><span class="n">ret</span><span class="w"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-20"><code data-line-number="20"></code></a></td>
<td class="code"><code><span class="k">End</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">assembler</span><span class="w"> </span><span class="k">dump</span><span class="p">.</span><span class="w"></span>
</code></td>
</tr>
</table></div>

<p>Burada fonksiyon ilkine göre biraz daha uzun görünüyor. Anlaşılmasına yardımcı olması için, bunun bir
benzeri C ile yazabiliriz.</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code><span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><span class="kt">int</span> <span class="n">canary</span><span class="p">;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><span class="k">struct</span> <span class="n">BoundArray</span> <span class="p">{</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code>    <span class="kt">char</span> <span class="n">array</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code>    <span class="kt">int</span>  <span class="n">boundary</span><span class="p">;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><span class="p">};</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code><span class="kt">void</span> <span class="nf">return_input</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><span class="p">{</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-14"><code data-line-number="14"></code></a></td>
<td class="code"><code>    <span class="k">struct</span> <span class="n">BoundArray</span> <span class="n">buffer</span><span class="p">;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-15"><code data-line-number="15"></code></a></td>
<td class="code"><code>    <span class="n">buffer</span><span class="p">.</span><span class="n">boundary</span> <span class="o">=</span> <span class="n">canary</span><span class="p">;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-16"><code data-line-number="16"></code></a></td>
<td class="code"><code>    <span class="n">gets</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">array</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-17"><code data-line-number="17"></code></a></td>
<td class="code"><code>    <span class="n">puts</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">array</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-18"><code data-line-number="18"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-19"><code data-line-number="19"></code></a></td>
<td class="code"><code>    <span class="k">if</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">boundary</span> <span class="o">==</span> <span class="n">canary</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-20"><code data-line-number="20"></code></a></td>
<td class="code"><code>        <span class="k">return</span><span class="p">;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-21"><code data-line-number="21"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-22"><code data-line-number="22"></code></a></td>
<td class="code"><code>    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"==== BUFFER OVERFLOW ===="</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-23"><code data-line-number="23"></code></a></td>
<td class="code"><code>    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-24"><code data-line-number="24"></code></a></td>
<td class="code"><code><span class="p">}</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-25"><code data-line-number="25"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-26"><code data-line-number="26"></code></a></td>
<td class="code"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-27"><code data-line-number="27"></code></a></td>
<td class="code"><code><span class="p">{</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-28"><code data-line-number="28"></code></a></td>
<td class="code"><code>    <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-29"><code data-line-number="29"></code></a></td>
<td class="code"><code>    <span class="n">canary</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-30"><code data-line-number="30"></code></a></td>
<td class="code"><code>    <span class="n">return_input</span><span class="p">();</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-31"><code data-line-number="31"></code></a></td>
<td class="code"><code>    <span class="n">printf</span><span class="p">(</span><span class="s">"return_input sonrasi main</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-32"><code data-line-number="32"></code></a></td>
<td class="code"><code>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-33"><code data-line-number="33"></code></a></td>
<td class="code"><code><span class="p">}</span>
</code></td>
</tr>
</table></div>

<p>Yukarıdaki program fno-stack-protector ile derlendiğinde (kendi stack protector mantığımızı yazdığımız için)
eğer komut satırından okunan metin 12 haneden daha az ise, <code>return_input</code> fonksiyonundan dönülecek. Eğer alınan
metin array sınırları dışına çıkarsa, <code>return_input</code> fonksiyonu asla dönmeyecek ve hata mesajı gösterilip program
sonlandırılacak. Bunu sağlamak için array'in hemen arkasına rastgele bir değer atıyoruz. Fonksiyondan dönmeden önce,
bu değerin aynı kaldığını test ediyoruz. Eğer bu değer değiştiyse, programın güvenilmez olduğuna karar verip,
çalışmayı durduruyoruz.</p>
<p>Yukarıdaki C programına bakarak, assembly çıktısını daha rahat inceleyebiliriz. Assembly çıktısındaki <code>mov eax,gs:0x14</code>
satırı, glibc'nin program başlangıcında, <code>main</code> çağırılmadan önce ayarladığı rastgele sayıyı (canary) alıyor ve <code>mov DWORD PTR [ebp-0xc],eax</code>
satırı bunu array'in sınırına kaydediyor. <code>gets</code> ve <code>puts</code> çağrısından sonra ise, <code>mov eax,DWORD PTR [ebp-0xc]</code> satırı, array
sınırındaki değeri okuyor ve <code>xor eax,DWORD PTR gs:0x14</code> satırı bu değerin değişmediğini teyit ediyor. Eğer bir değişme varsa,
glibc tarafından sağlanan <code>__stack_chk_fail</code> fonksiyonuna atlıyoruz. Bu fonksiyonun amacı, detaylı hata mesajı yazdırıp, programı
sonlandırmak.</p>
<p>Yukarıdaki örneği, bir de Visual Studio ile derleyip (Visual Studio 14, 32bit cl.exe -Z7 ile)
gcc ile karşılaştırabilriz.</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="kt">void</span> <span class="nf">return_input</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code><span class="p">{</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B30</span>  <span class="n">push</span>        <span class="n">ebp</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B31</span>  <span class="n">mov</span>         <span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B33</span>  <span class="n">sub</span>         <span class="n">esp</span><span class="p">,</span><span class="mi">10</span><span class="n">h</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B36</span>  <span class="n">mov</span>         <span class="n">eax</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">__security_cookie</span> <span class="p">(</span><span class="mf">0121E008</span><span class="n">h</span><span class="p">)]</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B3B</span>  <span class="n">xor</span>         <span class="n">eax</span><span class="p">,</span><span class="n">ebp</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B3D</span>  <span class="n">mov</span>         <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span><span class="n">eax</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code>    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code>    <span class="n">gets</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B40</span>  <span class="n">lea</span>         <span class="n">eax</span><span class="p">,[</span><span class="n">buffer</span><span class="p">]</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B43</span>  <span class="n">push</span>        <span class="n">eax</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B44</span>  <span class="n">call</span>        <span class="n">_gets</span> <span class="p">(</span><span class="mo">011</span><span class="n">C3508h</span><span class="p">)</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-14"><code data-line-number="14"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B49</span>  <span class="n">add</span>         <span class="n">esp</span><span class="p">,</span><span class="mi">4</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-15"><code data-line-number="15"></code></a></td>
<td class="code"><code>    <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-16"><code data-line-number="16"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B4C</span>  <span class="n">lea</span>         <span class="n">ecx</span><span class="p">,[</span><span class="n">buffer</span><span class="p">]</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-17"><code data-line-number="17"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B4F</span>  <span class="n">push</span>        <span class="n">ecx</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-18"><code data-line-number="18"></code></a></td>
<td class="code"><code>    <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-19"><code data-line-number="19"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B50</span>  <span class="n">push</span>        <span class="mf">121E000</span><span class="n">h</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-20"><code data-line-number="20"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B55</span>  <span class="n">call</span>        <span class="n">_printf</span> <span class="p">(</span><span class="mo">011</span><span class="n">C3990h</span><span class="p">)</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-21"><code data-line-number="21"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B5A</span>  <span class="n">add</span>         <span class="n">esp</span><span class="p">,</span><span class="mi">8</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-22"><code data-line-number="22"></code></a></td>
<td class="code"><code><span class="p">}</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-23"><code data-line-number="23"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B5D</span>  <span class="n">mov</span>         <span class="n">ecx</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-24"><code data-line-number="24"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B60</span>  <span class="n">xor</span>         <span class="n">ecx</span><span class="p">,</span><span class="n">ebp</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-25"><code data-line-number="25"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B62</span>  <span class="n">call</span>        <span class="p">@</span><span class="n">__security_check_cookie</span><span class="mi">@4</span> <span class="p">(</span><span class="mo">011</span><span class="n">C30FDh</span><span class="p">)</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-26"><code data-line-number="26"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B67</span>  <span class="n">mov</span>         <span class="n">esp</span><span class="p">,</span><span class="n">ebp</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-27"><code data-line-number="27"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B69</span>  <span class="n">pop</span>         <span class="n">ebp</span>  
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="stack-protector.html#-28"><code data-line-number="28"></code></a></td>
<td class="code"><code><span class="mo">011</span><span class="n">C6B6A</span>  <span class="n">ret</span>
</code></td>
</tr>
</table></div>

<p>Visual Studio da gcc gibi, stack üzerinde buffer overflow kontrolü yapıyor.</p>
<p>Toparlamak gerekirse, GCC ve Visual Studio (ve muhtemel diğer modern C derleyicileri)
stack üzerindeki buffer overflow'ların yan etkilerini kontrol altında tutmak için
ekstra kod üretiyorlar. Burada akılda kalması gereken husus, bu yöntemlerin
buffer overflow'u önlemek amaçlı değil, buffer overflow sonucunda programın yanlış
noktaya zıplamasını önlemek. Böylece, en klasik exploit yöntemlerinden birinin uygulanması
bir hayli zorlaşmış oluyor. Yine de, özellikle kritik programlarda, derleyiciden medet ummak yerine, programın
overflow'a izin vermeyecek şekilde tasarlanması veya, C#, Java, Python gibi hafıza
yönetimini kendi yapan bir dilde yazılması çok daha akıllıca bir seçim olacaktır diye düşünüyorum.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><div class="pager">
                <a href="../diger/yeni-tasarim.html" rel="prev" title="Blog Tasarımım Yenilendi">Önceki yazı</a>
                <a href="../windows/windows-api-ile-ekran-goruntusu.html" rel="next" title="Windows Api İle Ekran Görüntüsü Yakalamak">Sonraki yazı</a>
        </div>

    </nav></aside><script src="https://utteranc.es/client.js" repo="yasar11732/yasar11732.github.io" issue-term="title" theme="github-light" crossorigin="anonymous" async>
	</script></article></main><script>
  if(document.location.hostname == "yasar11732.github.io")
  {
      (function() {
        var cx = '013136674562336859018:ouohwab0yku';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
      
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-44774134-1', 'auto');
          ga('send', 'pageview');
  }

</script>
</body>
</html>
